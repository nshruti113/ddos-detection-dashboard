<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DDoS Detection Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: 'Courier New', 'Consolas', monospace;
        background: #0a0e27;
        background-image: 
            linear-gradient(rgba(0, 255, 0, 0.03) 1px, transparent 1px),
            linear-gradient(90deg, rgba(0, 255, 0, 0.03) 1px, transparent 1px);
        background-size: 20px 20px;
        min-height: 100vh;
        padding: 20px;
        color: #00ff00;
    }

    .container {
        max-width: 1400px;
        margin: 0 auto;
    }

    .header {
        text-align: center;
        color: #00ff00;
        margin-bottom: 30px;
        text-shadow: 0 0 10px #00ff00, 0 0 20px #00ff00;
        animation: glow 2s ease-in-out infinite alternate;
    }

    @keyframes glow {
        from { text-shadow: 0 0 5px #00ff00, 0 0 10px #00ff00, 0 0 15px #00ff00; }
        to { text-shadow: 0 0 10px #00ff00, 0 0 20px #00ff00, 0 0 30px #00ff00; }
    }

    .header h1 {
        font-size: 2.5rem;
        margin-bottom: 10px;
        font-weight: bold;
        letter-spacing: 3px;
    }

    .header p {
        color: #00cc00;
        font-size: 1rem;
        letter-spacing: 2px;
    }

    .status-banner {
        padding: 20px;
        border-radius: 0;
        border: 2px solid;
        margin-bottom: 20px;
        text-align: center;
        font-weight: bold;
        font-size: 1.3rem;
        letter-spacing: 2px;
        transition: all 0.3s ease;
        text-transform: uppercase;
        font-family: 'Courier New', monospace;
    }

    .status-normal {
        background: rgba(0, 255, 0, 0.1);
        border-color: #00ff00;
        color: #00ff00;
        box-shadow: 0 0 20px rgba(0, 255, 0, 0.3), inset 0 0 20px rgba(0, 255, 0, 0.1);
    }

    .status-attack {
        background: rgba(255, 0, 0, 0.2);
        border-color: #ff0000;
        color: #ff0000;
        box-shadow: 0 0 30px rgba(255, 0, 0, 0.5), inset 0 0 20px rgba(255, 0, 0, 0.2);
        animation: pulse 1s infinite, glitch 3s infinite;
    }

    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.7; }
    }

    @keyframes glitch {
        0% { transform: translate(0); }
        20% { transform: translate(-2px, 2px); }
        40% { transform: translate(-2px, -2px); }
        60% { transform: translate(2px, 2px); }
        80% { transform: translate(2px, -2px); }
        100% { transform: translate(0); }
    }

    .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
    }

    .card {
        background: rgba(10, 14, 39, 0.8);
        border: 2px solid #00ff00;
        border-radius: 0;
        padding: 20px;
        box-shadow: 0 0 20px rgba(0, 255, 0, 0.2), inset 0 0 20px rgba(0, 255, 0, 0.05);
        position: relative;
        overflow: hidden;
    }

    .card::before {
        content: '';
        position: absolute;
        top: -2px;
        left: -2px;
        right: -2px;
        bottom: -2px;
        background: linear-gradient(45deg, transparent, #00ff00, transparent);
        opacity: 0;
        transition: opacity 0.3s;
        z-index: -1;
    }

    .card:hover::before {
        opacity: 0.2;
        animation: borderGlow 2s linear infinite;
    }

    @keyframes borderGlow {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(100%); }
    }

    .card h2 {
        font-size: 1.2rem;
        margin-bottom: 15px;
        color: #00ff00;
        text-transform: uppercase;
        letter-spacing: 2px;
        border-bottom: 1px solid #00ff00;
        padding-bottom: 10px;
    }

    .metric {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 0;
        border-bottom: 1px solid rgba(0, 255, 0, 0.2);
        color: #00cc00;
    }

    .metric:last-child {
        border-bottom: none;
    }

    .metric-value {
        font-size: 1.5rem;
        font-weight: bold;
        color: #00ff00;
        text-shadow: 0 0 10px #00ff00;
        font-family: 'Courier New', monospace;
    }

    .chart-container {
        position: relative;
        height: 300px;
    }

    .alerts-container {
        max-height: 400px;
        overflow-y: auto;
    }

    .alerts-container::-webkit-scrollbar {
        width: 8px;
    }

    .alerts-container::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.3);
    }

    .alerts-container::-webkit-scrollbar-thumb {
        background: #00ff00;
        border-radius: 0;
    }

    .alert {
        padding: 15px;
        margin-bottom: 10px;
        border-radius: 0;
        border-left: 4px solid;
        background: rgba(0, 0, 0, 0.5);
        font-family: 'Courier New', monospace;
    }

    .alert-critical {
        background: rgba(255, 0, 0, 0.1);
        border-color: #ff0000;
        color: #ff6666;
        box-shadow: 0 0 10px rgba(255, 0, 0, 0.3);
    }

    .alert-warning {
        background: rgba(255, 165, 0, 0.1);
        border-color: #ffa500;
        color: #ffcc66;
    }

    .alert-info {
        background: rgba(0, 255, 255, 0.1);
        border-color: #00ffff;
        color: #66ffff;
    }

    .alert-title {
        font-weight: bold;
        margin-bottom: 5px;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .alert-time {
        font-size: 0.85rem;
        color: #00cc00;
        opacity: 0.7;
    }

    .ip-list {
        list-style: none;
    }

    .ip-item {
        display: flex;
        justify-content: space-between;
        padding: 8px;
        background: rgba(0, 255, 0, 0.05);
        margin-bottom: 5px;
        border-radius: 0;
        border-left: 2px solid #00ff00;
        color: #00ff00;
        font-family: 'Courier New', monospace;
    }

    .ip-badge {
        background: rgba(0, 255, 0, 0.2);
        color: #00ff00;
        padding: 2px 8px;
        border-radius: 0;
        border: 1px solid #00ff00;
        font-size: 0.85rem;
        font-weight: bold;
    }

    .connection-status {
        position: fixed;
        bottom: 20px;
        right: 20px;
        padding: 10px 20px;
        border-radius: 0;
        font-size: 0.9rem;
        font-weight: bold;
        border: 2px solid;
        font-family: 'Courier New', monospace;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .connected {
        background: rgba(0, 255, 0, 0.2);
        border-color: #00ff00;
        color: #00ff00;
        box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
    }

    .disconnected {
        background: rgba(255, 0, 0, 0.2);
        border-color: #ff0000;
        color: #ff0000;
        box-shadow: 0 0 20px rgba(255, 0, 0, 0.3);
        animation: blink 1s infinite;
    }

    @keyframes blink {
        0%, 50%, 100% { opacity: 1; }
        25%, 75% { opacity: 0.5; }
    }

    /* Matrix rain effect */
    body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext x='10' y='20' font-family='Courier' font-size='14' fill='%2300ff0022'%3E01%3C/text%3E%3Ctext x='30' y='40' font-family='Courier' font-size='14' fill='%2300ff0011'%3E10%3C/text%3E%3Ctext x='50' y='60' font-family='Courier' font-size='14' fill='%2300ff0033'%3E11%3C/text%3E%3C/svg%3E");
        pointer-events: none;
        opacity: 0.1;
        z-index: -1;
    }

    /* Cyber grid lines */
    .card::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-image: 
            linear-gradient(rgba(0, 255, 0, 0.05) 1px, transparent 1px),
            linear-gradient(90deg, rgba(0, 255, 0, 0.05) 1px, transparent 1px);
        background-size: 10px 10px;
        pointer-events: none;
        z-index: -1;
    }
</style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üõ°Ô∏è DDoS Detection Dashboard</h1>
            <p>Real-time Network Security Monitoring</p>
        </div>

        <div id="statusBanner" class="status-banner status-normal">
            ‚úÖ System Status: NORMAL
        </div>

        <div class="grid">
            <div class="card">
                <h2>üìä Live Metrics</h2>
                <div class="metric">
                    <span>Requests/Second</span>
                    <span class="metric-value" id="rps">0</span>
                </div>
                <div class="metric">
                    <span>Unique IPs</span>
                    <span class="metric-value" id="uniqueIps">0</span>
                </div>
                <div class="metric">
                    <span>Total Requests</span>
                    <span class="metric-value" id="totalRequests">0</span>
                </div>
                <div class="metric">
                    <span>IP Entropy</span>
                    <span class="metric-value" id="entropy">0.00</span>
                </div>
            </div>

            <div class="card">
                <h2>‚ö†Ô∏è Active Attacks</h2>
                <div class="metric">
                    <span>Attack Count</span>
                    <span class="metric-value" id="attackCount" style="color: #ef4444;">0</span>
                </div>
                <div id="attackTypes" style="margin-top: 15px;">
                    <p style="color: #666;">No active attacks detected</p>
                </div>
            </div>

            <div class="card">
                <h2>üîù Top Source IPs</h2>
                <ul class="ip-list" id="topIps">
                    <li style="color: #666; text-align: center;">Loading...</li>
                </ul>
            </div>
        </div>

        <div class="grid">
            <div class="card">
                <h2>üìà Traffic Rate (Last 60s)</h2>
                <div class="chart-container">
                    <canvas id="trafficChart"></canvas>
                </div>
            </div>

            <div class="card">
                <h2>üö® Security Alerts</h2>
                <div class="alerts-container" id="alertsContainer">
                    <p style="color: #666; text-align: center;">No alerts</p>
                </div>
            </div>
        </div>
    </div>

    <div id="connectionStatus" class="connection-status disconnected">
        ‚ö†Ô∏è Connecting...
    </div>

    <script>
        let ws;
        let reconnectInterval;
        const alerts = [];
        const trafficData = [];
        const maxDataPoints = 60;

        // Chart setup
        const ctx = document.getElementById('trafficChart').getContext('2d');
        const trafficChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: 'Requests/Second',
                    data: [],
                    borderColor: '#667eea',
                    backgroundColor: 'rgba(102, 126, 234, 0.1)',
                    tension: 0.4,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        function connectWebSocket() {
            ws = new WebSocket('ws://localhost:8888/ws');

            ws.onopen = () => {
                console.log('WebSocket connected');
                document.getElementById('connectionStatus').className = 'connection-status connected';
                document.getElementById('connectionStatus').textContent = '‚úÖ Connected';
                clearInterval(reconnectInterval);
            };

            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                
                if (data.type === 'metrics') {
                    updateMetrics(data.payload);
                } else if (data.type === 'alert') {
                    addAlert(data.payload);
                }
            };

            ws.onclose = () => {
                console.log('WebSocket disconnected');
                document.getElementById('connectionStatus').className = 'connection-status disconnected';
                document.getElementById('connectionStatus').textContent = '‚ö†Ô∏è Disconnected';
                
                reconnectInterval = setInterval(connectWebSocket, 5000);
            };

            ws.onerror = (error) => {
                console.error('WebSocket error:', error);
            };
        }

        function updateMetrics(metrics) {
            document.getElementById('rps').textContent = metrics.requests_per_sec?.toFixed(1) || '0';
            document.getElementById('uniqueIps').textContent = metrics.unique_ips || '0';
            document.getElementById('totalRequests').textContent = metrics.total_requests || '0';
            document.getElementById('entropy').textContent = metrics.ip_entropy?.toFixed(2) || '0.00';

            const now = new Date().toLocaleTimeString();
            trafficData.push({
                time: now,
                rps: metrics.requests_per_sec || 0
            });

            if (trafficData.length > maxDataPoints) {
                trafficData.shift();
            }

            trafficChart.data.labels = trafficData.map(d => d.time);
            trafficChart.data.datasets[0].data = trafficData.map(d => d.rps);
            trafficChart.update('none');

            if (metrics.top_ips && metrics.top_ips.length > 0) {
                const ipList = document.getElementById('topIps');
                ipList.innerHTML = metrics.top_ips.slice(0, 5).map(ip => `
                    <li class="ip-item">
                        <span>${ip.ip}</span>
                        <span class="ip-badge">${ip.count} req</span>
                    </li>
                `).join('');
            }
        }

        function addAlert(alert) {
            alerts.unshift(alert);
            if (alerts.length > 10) alerts.pop();

            const container = document.getElementById('alertsContainer');
            container.innerHTML = alerts.map(a => `
                <div class="alert alert-${a.level.toLowerCase()}">
                    <div class="alert-title">${a.title}</div>
                    <div>${a.message}</div>
                    <div class="alert-time">${new Date(a.timestamp).toLocaleString()}</div>
                </div>
            `).join('');

            const statusBanner = document.getElementById('statusBanner');
            statusBanner.className = 'status-banner status-attack';
            statusBanner.textContent = `üö® ALERT: ${alert.title}`;

            const attackCount = alerts.filter(a => a.level === 'CRITICAL').length;
            document.getElementById('attackCount').textContent = attackCount;
        }

        async function fetchStats() {
            try {
                const response = await fetch('http://localhost:8888/api/stats/summary');
                const data = await response.json();

                if (data.status === 'NORMAL') {
                    const statusBanner = document.getElementById('statusBanner');
                    if (!statusBanner.classList.contains('status-attack')) {
                        statusBanner.className = 'status-banner status-normal';
                        statusBanner.textContent = '‚úÖ System Status: NORMAL';
                    }
                }

                document.getElementById('attackCount').textContent = data.active_attacks || '0';
            } catch (error) {
                console.error('Error fetching stats:', error);
            }
        }

        connectWebSocket();
        setInterval(fetchStats, 5000);
        fetchStats();
    </script>
</body>
</html>